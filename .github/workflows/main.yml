name: Build Unreal Engine Game

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: ubuntu-latest
  
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: download Docker
        run: docker pull ghcr.io/epicgames/unreal-cloud-ddc:1.2.0_helm
      
      - name: Build and Package Game
        run: |
          docker run --rm -i -v "${{ github.workspace }}/${{ env.PROJECT_NAME }}_Project:/project" -w /home/ue4/UnrealEngine ghcr.io/epicgames/unreal-engine:dev-slim-5.4.2 \
          ./Engine/Build/BatchFiles/RunUAT.sh \
          BuildCookRun \
            -utf8output \
            -platform=Win64 \
            -clientconfig=Shipping \
            -serverconfig=Shipping \
            -project=/project/${{ env.PROJECT_NAME }}_Project.uproject \
            -noP4 -nodebuginfo -allmaps \
            -cook -build -stage -prereqs -pak -archive \
            -archivedirectory=/project/Packaged
